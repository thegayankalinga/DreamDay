@model DreamDay.ViewModels.PlannerDashboardViewModel
@{
    ViewData["Title"] = "Planner Dashboard";
    Layout = "_Dashboard";
}

<div class="container-fluid px-4">
    <h1 class="mt-4">Planner Dashboard</h1>
    <ol class="breadcrumb mb-4">
        <li class="breadcrumb-item active">Dashboard</li>
    </ol>
    
    <!-- Summary Cards -->
    <div class="row">
        <div class="col-xl-3 col-md-6">
            <div class="card bg-primary text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>Active Weddings</div>
                        <div><h2>@Model.ActiveWeddingsCount</h2></div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" asp-controller="Planner" asp-action="ActiveWeddings">View Details</a>
                    <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-warning text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>Pending Tasks</div>
                        <div><h2>@Model.PendingTasksCount</h2></div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" asp-controller="Planner" asp-action="PendingTasks">View Details</a>
                    <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-success text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>Upcoming Weddings</div>
                        <div><h2>@Model.UpcomingWeddingsCount</h2></div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" asp-controller="Planner" asp-action="UpcomingWeddings">View Details</a>
                    <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                </div>
            </div>
        </div>
        <div class="col-xl-3 col-md-6">
            <div class="card bg-danger text-white mb-4">
                <div class="card-body">
                    <div class="d-flex justify-content-between">
                        <div>Messages</div>
                        <div><h2>@Model.UnreadMessagesCount</h2></div>
                    </div>
                </div>
                <div class="card-footer d-flex align-items-center justify-content-between">
                    <a class="small text-white stretched-link" asp-controller="Planner" asp-action="Messages">View Details</a>
                    <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Calendar and Tasks -->
    <div class="row">
        <!-- Calendar of Upcoming Events -->
        <div class="col-xl-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-calendar me-1"></i>
                    Upcoming Wedding Events
                </div>
                <div class="card-body">
                    <div id="plannerCalendar"></div>
                </div>
            </div>
        </div>
        
        <!-- Recent Tasks -->
        <div class="col-xl-6">
            <div class="card mb-4">
                <div class="card-header">
                    <i class="fas fa-tasks me-1"></i>
                    Recent Tasks
                </div>
                <div class="card-body">
                    @if (Model.RecentTasks.Any())
                    {
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Task</th>
                                        <th>Wedding</th>
                                        <th>Due Date</th>
                                        <th>Status</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var task in Model.RecentTasks)
                                    {
                                        <tr>
                                            <td>@task.TaskName</td>
                                            <td>@task.WeddingName</td>
                                            <td>@task.DueDate.ToShortDateString()</td>
                                            <td>
                                                <span class="badge @(task.Status == "Completed" ? "bg-success" : 
                                                                      task.Status == "In Progress" ? "bg-primary" : 
                                                                      task.Status == "Overdue" ? "bg-danger" : "bg-warning")">
                                                    @task.Status
                                                </span>
                                            </td>
                                        </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    }
                    else
                    {
                        <p>No recent tasks found.</p>
                    }
                </div>
            </div>
        </div>
    </div>
    
    <!-- Recent Weddings -->
    <div class="card mb-4">
        <div class="card-header">
            <i class="fas fa-ring me-1"></i>
            Weddings You're Managing
        </div>
        <div class="card-body">
            @if (Model.Weddings.Any())
            {
                <div class="table-responsive">
                    <table id="weddingsTable" class="table table-striped">
                        <thead>
                            <tr>
                                <th>Couple</th>
                                <th>Wedding Date</th>
                                <th>Venue</th>
                                <th>Checklist Progress</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var wedding in Model.Weddings)
                            {
                                <tr>
                                    <td>@wedding.CoupleName</td>
                                    <td>@wedding.WeddingDate.ToShortDateString()</td>
                                    <td>@wedding.VenueName</td>
                                    <td>
                                        <div class="progress">
                                            <div class="progress-bar" role="progressbar" style="width: @wedding.ChecklistProgress%;" 
                                                 aria-valuenow="@wedding.ChecklistProgress" aria-valuemin="0" aria-valuemax="100">
                                                @wedding.ChecklistProgress%
                                            </div>
                                        </div>
                                    </td>
                                    <td><span class="badge @(wedding.Status == "Active" ? "bg-success" : "bg-primary")">@wedding.Status</span></td>
                                    <td>
                                        <a asp-controller="Planner" asp-action="WeddingDetails" asp-route-id="@wedding.Id" 
                                           class="btn btn-sm btn-primary"><i class="fas fa-eye"></i></a>
                                        <a asp-controller="Planner" asp-action="ManageChecklist" asp-route-id="@wedding.Id" 
                                           class="btn btn-sm btn-info"><i class="fas fa-tasks"></i></a>
                                        <a asp-controller="Planner" asp-action="MessageCouple" asp-route-id="@wedding.Id" 
                                           class="btn btn-sm btn-success"><i class="fas fa-comment"></i></a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <p>No weddings assigned to you yet.</p>
                <a asp-controller="Planner" asp-action="AvailableWeddings" class="btn btn-primary">Find Available Weddings</a>
            }
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.10.0/main.min.css" rel="stylesheet" />
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize DataTable for weddings
            const weddingsTable = document.getElementById('weddingsTable');
            if (weddingsTable) {
                new simpleDatatables.DataTable(weddingsTable);
            }
            
            // Initialize Calendar
            const calendarEl = document.getElementById('plannerCalendar');
            if (calendarEl) {
                const calendar = new FullCalendar.Calendar(calendarEl, {
                    initialView: 'dayGridMonth',
                    headerToolbar: {
                        left: 'prev,next today',
                        center: 'title',
                        right: 'dayGridMonth,timeGridWeek'
                    },
                    events: '/Planner/GetCalendarEvents',
                    eventClick: function(info) {
                        // Handle event click
                        window.location.href = `/Planner/EventDetails/${info.event.id}`;
                    }
                });
                calendar.render();
            }
        });
    </script>
}